# TeachAid - AIè¾…åŠ©æ•™å­¦å¹³å°

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

TeachAidæ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„AIè¾…åŠ©æ•™å­¦å¹³å°ï¼Œæ—¨åœ¨æå‡æ•™åŸ¹æœºæ„æ•™å­¦æ•ˆç‡ã€‚å¹³å°é€šè¿‡å¤šæ¨¡æ€AIæŠ€æœ¯ï¼Œå°†ä¼ ç»Ÿé¢˜ç›®ç­”æ¡ˆè½¬æ¢ä¸ºæ›´é€‚åˆæ•™å­¦çš„å¼•å¯¼å¼å†…å®¹ï¼Œå¹¶ä¸ºå­¦ç”Ÿæä¾›æ™ºèƒ½åŒ–çš„å­¦ä¹ äº’åŠ¨ä½“éªŒã€‚

### æ ¸å¿ƒä»·å€¼
- **æ•™å¸ˆç«¯**ï¼šæ™ºèƒ½åŒ–é¢˜ç›®å¤„ç†ï¼Œæå‡å¤‡è¯¾æ•ˆç‡
- **å­¦ç”Ÿç«¯**ï¼šä¸ªæ€§åŒ–å­¦ä¹ å¼•å¯¼ï¼Œå¢å¼ºç†è§£æ•ˆæœ
- **æœºæ„ç«¯**ï¼šæ•°æ®åŒ–æ•™å­¦ç®¡ç†ï¼Œä¼˜åŒ–æ•™å­¦è´¨é‡

## äºŒã€æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆé€‰å‹
```
åç«¯ï¼šFastAPI + Python 3.11+
å‰ç«¯ï¼šVue 3.5+ + Vben Admin 5.0 + JavaScript + Ant Design Vue
æ„å»ºå·¥å…·ï¼šVite 5.0+ + Pnpm Monorepo + TurboRepo
AIæ¡†æ¶ï¼šLangGraph (å·¥ä½œæµç¼–æ’) + LiteLLM (å¤šæ¨¡å‹ç»Ÿä¸€æ¥å£)
æ•°æ®åº“ï¼šMySQL 8.0+ (ä¸»åº“) + Redis 7+ (ç¼“å­˜)
å¤šæ¨¡æ€AIï¼šGPT-4V / Claude-3 / é€šä¹‰åƒé—®VL / Yi-Vision
ç›‘æ§è°ƒè¯•ï¼šLangSmith (AIåº”ç”¨å¯è§‚æµ‹æ€§)
ä»£ç è§„èŒƒï¼šESLint + Prettier + Stylelint
éƒ¨ç½²ï¼šDocker + Nginx
é¡¹ç›®ç»“æ„ï¼šå‰åç«¯ä¸€ä½“åŒ–ç›®å½•ç»“æ„
```

### æ¶æ„ç‰¹ç‚¹
- **æ™ºèƒ½å·¥ä½œæµç¼–æ’**ï¼šLangGraphå¤„ç†å¤æ‚å¤šæ­¥éª¤æ•™å­¦æµç¨‹ï¼Œæ”¯æŒçŠ¶æ€ç®¡ç†å’Œäººæœºäº¤äº’
- **ç»Ÿä¸€å¤šæ¨¡å‹æ¥å£**ï¼šLiteLLMæä¾›100+ LLMç»Ÿä¸€è°ƒç”¨ï¼Œæ”¯æŒè‡ªåŠ¨fallbackå’Œæˆæœ¬ä¼˜åŒ–
- **å¤šæ¨¡æ€ç†è§£**ï¼šä½¿ç”¨è§†è§‰å¤§æ¨¡å‹æ›¿ä»£ä¼ ç»ŸOCRï¼Œå‡†ç¡®ç†è§£å¤æ‚å›¾è¡¨å…¬å¼
- **æ™ºèƒ½æ¨¡å‹è·¯ç”±**ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦ã€æˆæœ¬é¢„ç®—ã€æ€§èƒ½è¡¨ç°è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ¨¡å‹
- **æ•…éšœå®¹é”™æœºåˆ¶**ï¼šæ¨¡å‹æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æ¨¡å‹ï¼Œä¿è¯æœåŠ¡ç¨³å®šæ€§
- **å®æ—¶ç›‘æ§è°ƒè¯•**ï¼šé›†æˆLangSmithï¼Œæä¾›å®Œæ•´çš„AIåº”ç”¨å¯è§‚æµ‹æ€§
- **ä¼ä¸šçº§å‰ç«¯æ¶æ„**ï¼šåŸºäºVben Admin 5.0ï¼Œæä¾›å®Œå–„çš„æƒé™ç®¡ç†ã€ä¸»é¢˜åˆ‡æ¢ã€å›½é™…åŒ–æ”¯æŒ
- **ç°ä»£åŒ–å·¥ç¨‹ä½“ç³»**ï¼šJavaScriptè½»é‡å¼€å‘ï¼ŒMonorepoæ¶æ„ï¼Œå®Œå–„çš„ä»£ç è§„èŒƒ

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 3.1 å¤šæ¨¡æ€é¢˜ç›®å¯¼å…¥ç³»ç»Ÿ

#### åŠŸèƒ½æè¿°
æ”¯æŒå¤šç§æ ¼å¼çš„æ•™å­¦ææ–™å¯¼å…¥ï¼Œé€šè¿‡å¤šæ¨¡æ€AIè¿›è¡Œæ™ºèƒ½è§£æå’Œç»“æ„åŒ–å¤„ç†ã€‚

#### æ”¯æŒæ ¼å¼
- **å›¾ç‰‡æ ¼å¼**ï¼šJPG, PNG, WEBP (å•å¼ /æ‰¹é‡ä¸Šä¼ )
- **æ–‡æ¡£æ ¼å¼**ï¼šPDF (å¤šé¡µè‡ªåŠ¨åˆ†å‰²)
- **æ–‡æœ¬æ ¼å¼**ï¼šç›´æ¥ç²˜è´´æˆ–TXTæ–‡ä»¶ä¸Šä¼ 

#### æŠ€æœ¯å®ç°æ–¹æ¡ˆ

##### ç»Ÿä¸€å¤šæ¨¡æ€å¤„ç†æ¡†æ¶
```python
# app/core/unified_ai_framework.py
import litellm
from langgraph.graph import StateGraph, END
from langgraph.checkpoint.postgres import PostgresSaver

class UnifiedAIFramework:
    def __init__(self):
        # LiteLLMæ¨¡å‹é…ç½® - æ”¯æŒæ™ºèƒ½åˆ‡æ¢
        self.model_config = {
            "primary": {
                "vision": "gpt-4o",  # ä¸»åŠ›è§†è§‰æ¨¡å‹
                "chat": "gpt-4o-mini",  # å¯¹è¯æ¨¡å‹
                "rewrite": "claude-3-5-sonnet-20241022"  # æ”¹å†™æ¨¡å‹
            },
            "fallback": {
                "vision": "qwen-vl-max",
                "chat": "deepseek-chat", 
                "rewrite": "yi-large"
            },
            "budget": {
                "vision": "qwen-vl-plus",  # æˆæœ¬ä¼˜åŒ–
                "chat": "qwen-turbo",
                "rewrite": "moonshot-v1-8k"
            }
        }
        
        # LangGraphå·¥ä½œæµ
        self.question_workflow = self._build_question_processing_workflow()
        
    async def extract_qa_content(self, file_path: str, complexity: str = "medium") -> dict:
        """æ™ºèƒ½å¤šæ¨¡æ€å†…å®¹æå–"""
        
        # æ ¹æ®å¤æ‚åº¦æ™ºèƒ½é€‰æ‹©æ¨¡å‹
        model_tier = self._select_model_tier(complexity)
        model = self.model_config[model_tier]["vision"]
        
        extraction_prompt = self._build_extraction_messages(file_path)
        
        try:
            # LiteLLMç»Ÿä¸€è°ƒç”¨å¤šå®¶æ¨¡å‹
            response = await litellm.acompletion(
                model=model,
                messages=extraction_prompt,
                temperature=0.1,
                max_tokens=2000
            )
            
            return {
                "extracted_content": response.choices[0].message.content,
                "model_used": model,
                "cost": response.usage.total_tokens * self._get_model_cost(model)
            }
            
        except Exception as e:
            # è‡ªåŠ¨fallbackåˆ°å¤‡ç”¨æ¨¡å‹
            return await self._fallback_extraction(file_path, str(e))
    
    def _build_question_processing_workflow(self) -> StateGraph:
        """æ„å»ºé¢˜ç›®å¤„ç†å·¥ä½œæµ - LangGraph"""
        
        workflow = StateGraph(QuestionProcessingState)
        
        # æ·»åŠ å¤„ç†èŠ‚ç‚¹
        workflow.add_node("extract_content", self.extract_with_litellm)
        workflow.add_node("validate_extraction", self.validate_content)
        workflow.add_node("rewrite_answer", self.rewrite_with_best_model)
        workflow.add_node("quality_assessment", self.assess_quality)
        workflow.add_node("save_result", self.save_to_database)
        workflow.add_node("handle_error", self.handle_error)
        
        # æ™ºèƒ½æ¡ä»¶è·¯ç”±
        workflow.add_conditional_edges(
            "extract_content",
            self.should_continue_processing,
            {
                "continue": "validate_extraction",
                "retry": "extract_content",
                "error": "handle_error"
            }
        )
        
        # è®¾ç½®æ£€æŸ¥ç‚¹ - æ”¯æŒé•¿æ—¶é—´è¿è¡Œå’Œæ•…éšœæ¢å¤
        return workflow.compile(checkpointer=PostgresSaver())
    
    async def rewrite_with_best_model(self, state: dict) -> dict:
        """æ™ºèƒ½æ¨¡å‹é€‰æ‹©æ”¹å†™ç­”æ¡ˆ"""
        
        # æ ¹æ®å­¦ç§‘å’Œé¢˜å‹é€‰æ‹©æœ€ä¼˜æ¨¡å‹
        best_model = self._select_rewrite_model(
            state["subject"], 
            state["question_type"]
        )
        
        response = await litellm.acompletion(
            model=best_model,
            messages=self._build_rewrite_prompt(state),
            temperature=0.7,
            stream=True  # æ”¯æŒæµå¼å“åº”
        )
        
        return {
            **state,
            "rewritten_answer": response.choices[0].message.content,
            "model_used": best_model,
            "processing_time": time.time() - state["start_time"]
        }
```

##### æ–‡ä»¶é¢„å¤„ç†æµç¨‹
```python
# app/services/file_processor.py
class FileProcessorService:
    async def preprocess_upload(self, file: UploadFile) -> List[str]:
        """æ–‡ä»¶é¢„å¤„ç†å’Œåˆ†å‰²"""
        
        # ä¿å­˜ä¸Šä¼ æ–‡ä»¶
        file_path = await self._save_upload_file(file)
        
        if file.filename.endswith('.pdf'):
            # PDFåˆ†é¡µå¤„ç†
            pages = await self._split_pdf_pages(file_path)
            return [await self._pdf_page_to_image(page) for page in pages]
        else:
            # å›¾ç‰‡å¤„ç†ï¼ˆå‹ç¼©ã€æ ¼å¼è½¬æ¢ï¼‰
            processed_path = await self._process_image(file_path)
            return [processed_path]
    
    async def _split_pdf_pages(self, pdf_path: str) -> List[str]:
        """PDFæŒ‰é¡µåˆ†å‰²"""
        import fitz  # PyMuPDF
        
        doc = fitz.open(pdf_path)
        pages = []
        
        for page_num in range(doc.page_count):
            page = doc[page_num]
            # è½¬æ¢ä¸ºé«˜åˆ†è¾¨ç‡å›¾ç‰‡
            pix = page.get_pixmap(matrix=fitz.Matrix(2, 2))
            img_path = f"/tmp/page_{page_num}.png"
            pix.save(img_path)
            pages.append(img_path)
            
        doc.close()
        return pages
```

### 3.2 æ™ºèƒ½æç¤ºè¯ç®¡ç†ç³»ç»Ÿ

#### åŠŸèƒ½æè¿°
æ”¯æŒæç¤ºè¯æ¨¡æ¿çš„åˆ›å»ºã€ç¼–è¾‘ã€æµ‹è¯•å’Œç‰ˆæœ¬ç®¡ç†ï¼Œä¸ºä¸åŒå­¦ç§‘å’Œé¢˜å‹æä¾›ä¸“ä¸šçš„æ”¹å†™ç­–ç•¥ã€‚

#### æ ¸å¿ƒç‰¹æ€§
- **åˆ†å±‚æç¤ºè¯**ï¼šç³»ç»Ÿçº§ â†’ å­¦ç§‘çº§ â†’ é¢˜å‹çº§
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æŒæç¤ºè¯è¿­ä»£å’Œå›æ»š
- **æ•ˆæœæµ‹è¯•**ï¼šåœ¨çº¿é¢„è§ˆæ”¹å†™æ•ˆæœ
- **æ™ºèƒ½ç¼“å­˜**ï¼šåŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„ç¼“å­˜æœºåˆ¶

#### æŠ€æœ¯å®ç°æ–¹æ¡ˆ

##### æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ
```python
# app/services/prompt_template_service.py
class PromptTemplateService:
    def __init__(self):
        self.cache_service = PromptCacheService()
        self.templates = {}
    
    async def create_template(self, template_data: dict) -> PromptTemplate:
        """åˆ›å»ºæç¤ºè¯æ¨¡æ¿"""
        
        template = PromptTemplate(
            id=template_data["id"],
            name=template_data["name"],
            category=template_data["category"],  # system/subject/type
            level=template_data["level"],        # ä¼˜å…ˆçº§
            system_prompt=template_data["system_prompt"],
            user_prompt_template=template_data["user_prompt_template"],
            variables=template_data["variables"],
            examples=template_data.get("examples", []),
            version=1
        )
        
        await self.db.save(template)
        return template
    
    async def render_prompt(self, template_id: str, **variables) -> List[BaseMessage]:
        """æ¸²æŸ“æç¤ºè¯æ¨¡æ¿"""
        
        template = await self.get_template(template_id)
        
        # æ„å»ºç³»ç»Ÿæç¤º
        system_prompt = template.system_prompt
        
        # æ¸²æŸ“ç”¨æˆ·æç¤º
        user_prompt = template.user_prompt_template.format(**variables)
        
        # æ·»åŠ å°‘æ ·æœ¬ç¤ºä¾‹
        messages = [{"role": "system", "content": system_prompt}]
        
        for example in template.examples:
            messages.extend([
                {"role": "user", "content": example["input"]},
                {"role": "assistant", "content": example["output"]}
            ])
        
        messages.append({"role": "user", "content": user_prompt})
        
        return messages

# å†…ç½®æç¤ºè¯æ¨¡æ¿
BUILTIN_TEMPLATES = {
    "math_calculation": {
        "name": "æ•°å­¦è®¡ç®—é¢˜æ”¹å†™",
        "system_prompt": """ä½ æ˜¯ä¸€ä½èµ„æ·±æ•°å­¦æ•™å¸ˆï¼Œæ“…é•¿å°†å¤æ‚çš„æ•°å­¦è§£ç­”è½¬æ¢ä¸ºå¯å‘å¼çš„æ•™å­¦å†…å®¹ã€‚

æ”¹å†™åŸåˆ™ï¼š
1. ä¿ç•™åŸç­”æ¡ˆçš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§
2. å°†ç›´æ¥çš„è®¡ç®—æ­¥éª¤è½¬æ¢ä¸ºå¼•å¯¼å¼é—®é¢˜
3. å¢åŠ æ€è·¯è§£æå’Œæ–¹æ³•æ€»ç»“
4. çªå‡ºæ˜“é”™ç‚¹å’Œæ³¨æ„äº‹é¡¹
5. é€‚å½“æ·»åŠ å˜å¼ç»ƒä¹ å»ºè®®

æ”¹å†™é£æ ¼ï¼š
- è¯­è¨€äº²åˆ‡ï¼Œç¬¦åˆå­¦ç”Ÿè®¤çŸ¥æ°´å¹³
- é€»è¾‘æ¸…æ™°ï¼Œæ­¥éª¤åˆ†æ˜
- å¯Œæœ‰å¯å‘æ€§ï¼Œé¿å…ç›´æ¥ç»™å‡ºç­”æ¡ˆ
""",
        "user_prompt_template": """
åŸé¢˜ç›®ï¼š{question}
åŸç­”æ¡ˆï¼š{answer}
å­¦ç”Ÿæ°´å¹³ï¼š{grade_level}

è¯·å°†ä¸Šè¿°ç­”æ¡ˆæ”¹å†™ä¸ºæ›´é€‚åˆæ•™å­¦çš„ç‰ˆæœ¬ã€‚
""",
        "variables": ["question", "answer", "grade_level"]
    }
}
```

##### æ™ºèƒ½ç¼“å­˜å’Œæˆæœ¬æ§åˆ¶
```python
# app/services/intelligent_cache_service.py
import litellm
from litellm import BudgetManager

class IntelligentCacheService:
    def __init__(self):
        # LiteLLMå†…ç½®ç¼“å­˜
        litellm.cache = litellm.Cache()
        
        # æˆæœ¬ç®¡ç†
        self.budget_manager = BudgetManager(
            project_name="TeachAid",
            budget_limit=1000.0  # æœˆé¢„ç®—é™åˆ¶
        )
        
        # Redisè¯­ä¹‰ç¼“å­˜
        self.semantic_cache = RedisSemanticCache(
            redis_url="redis://localhost:6379",
            embedding=OpenAIEmbeddings(),
            score_threshold=0.85
        )
    
    async def cached_completion(self, 
                              messages: List[dict], 
                              model: str,
                              **kwargs) -> str:
        """å¸¦ç¼“å­˜çš„LLMè°ƒç”¨"""
        
        # æ£€æŸ¥é¢„ç®—
        if self.budget_manager.get_current_cost() > self.budget_manager.budget_limit * 0.9:
            # é¢„ç®—ä¸è¶³æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°ç»æµæ¨¡å‹
            model = self._get_budget_model(model)
        
        # LiteLLMè‡ªåŠ¨å¤„ç†ç¼“å­˜
        response = await litellm.acompletion(
            model=model,
            messages=messages,
            cache={
                "use_cache": True,
                "cache_params": {
                    "similarity_threshold": 0.8,
                    "ttl": 3600
                }
            },
            **kwargs
        )
        
        # è®°å½•æˆæœ¬
        cost = litellm.completion_cost(completion_response=response)
        await self.budget_manager.track_cost(model, cost)
        
        return response.choices[0].message.content
    
    def _get_budget_model(self, original_model: str) -> str:
        """è·å–ç»æµæ›¿ä»£æ¨¡å‹"""
        budget_alternatives = {
            "gpt-4o": "gpt-4o-mini",
            "claude-3-5-sonnet-20241022": "claude-3-haiku-20240307",
            "gpt-4-vision-preview": "qwen-vl-plus"
        }
        return budget_alternatives.get(original_model, "qwen-turbo")
```

### 3.3 AIç­”æ¡ˆæ”¹å†™å¼•æ“

#### åŠŸèƒ½æè¿°
åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„ç­”æ¡ˆæ”¹å†™ç³»ç»Ÿï¼Œå°†æ ‡å‡†ç­”æ¡ˆè½¬æ¢ä¸ºå¼•å¯¼å¼æ•™å­¦å†…å®¹ã€‚

#### æ”¹å†™ç­–ç•¥
- **å¯å‘å¼å¼•å¯¼**ï¼šç”¨é—®é¢˜ä»£æ›¿ç›´æ¥ç­”æ¡ˆ
- **åˆ†æ­¥éª¤è®²è§£**ï¼šå¤æ‚é—®é¢˜æ‹†è§£ä¸ºç®€å•æ­¥éª¤  
- **æ€ç»´è¿‡ç¨‹å±•ç¤º**ï¼šå±•ç°è§£é¢˜æ€è·¯å’Œæ–¹æ³•
- **æ˜“é”™ç‚¹æé†’**ï¼šé¢„é˜²å¸¸è§é”™è¯¯
- **æ‰©å±•ç»ƒä¹ **ï¼šæä¾›ç›¸å…³å˜å¼é¢˜ç›®

#### æŠ€æœ¯å®ç°æ–¹æ¡ˆ

```python
# app/services/intelligent_rewriting_service.py
class IntelligentRewritingService:
    def __init__(self):
        self.ai_framework = UnifiedAIFramework()
        self.template_service = PromptTemplateService()
        self.cache_service = IntelligentCacheService()
        
        # LangGraphæ”¹å†™å·¥ä½œæµ
        self.rewrite_workflow = self._build_rewrite_workflow()
    
    def _build_rewrite_workflow(self) -> StateGraph:
        """æ„å»ºæ™ºèƒ½æ”¹å†™å·¥ä½œæµ"""
        workflow = StateGraph(RewriteState)
        
        workflow.add_node("analyze_content", self.analyze_question_complexity)
        workflow.add_node("select_strategy", self.select_rewrite_strategy)
        workflow.add_node("generate_rewrite", self.generate_with_best_model)
        workflow.add_node("quality_check", self.assess_quality_score)
        workflow.add_node("optimize_result", self.optimize_teaching_effect)
        
        # æ™ºèƒ½è·¯ç”±ï¼šæ ¹æ®è´¨é‡åˆ†æ•°å†³å®šæ˜¯å¦éœ€è¦ä¼˜åŒ–
        workflow.add_conditional_edges(
            "quality_check",
            self.should_optimize,
            {
                "optimize": "optimize_result",
                "accept": END,
                "retry": "select_strategy"
            }
        )
        
        return workflow.compile()
    
    async def rewrite_answer(self, 
                           question: str,
                           original_answer: str,
                           subject: str = "é€šç”¨",
                           question_type: str = "è§£ç­”é¢˜",
                           grade_level: str = "åˆä¸­") -> dict:
        """æ™ºèƒ½ç­”æ¡ˆæ”¹å†™ - å¤šæ¨¡å‹ååŒ"""
        
        # å¯åŠ¨LangGraphå·¥ä½œæµ
        initial_state = {
            "question": question,
            "original_answer": original_answer,
            "subject": subject,
            "question_type": question_type,
            "grade_level": grade_level,
            "complexity": "unknown",
            "quality_score": 0
        }
        
        result = await self.rewrite_workflow.ainvoke(initial_state)
        
        return result
    
    async def generate_with_best_model(self, state: dict) -> dict:
        """ä½¿ç”¨æœ€ä½³æ¨¡å‹ç”Ÿæˆæ”¹å†™"""
        
        # æ™ºèƒ½æ¨¡å‹é€‰æ‹©ç­–ç•¥
        best_model = self._select_optimal_model(state)
        
        # æ„å»ºä¸“ä¸šæç¤ºè¯
        messages = await self._build_rewrite_messages(state, best_model)
        
        # ä½¿ç”¨LiteLLMè°ƒç”¨æœ€ä¼˜æ¨¡å‹
        response = await self.cache_service.cached_completion(
            messages=messages,
            model=best_model,
            temperature=0.7,
            max_tokens=2000
        )
        
        return {
            **state,
            "rewritten_answer": response,
            "model_used": best_model,
            "tokens_used": len(response.split()) * 1.3  # ä¼°ç®—
        }
    
    def _select_optimal_model(self, state: dict) -> str:
        """æ ¹æ®é¢˜ç›®ç‰¹å¾é€‰æ‹©æœ€ä¼˜æ¨¡å‹"""
        
        subject = state["subject"]
        complexity = state["complexity"]
        
        # å­¦ç§‘ä¸“ä¸šåŒ–é€‰æ‹©
        if subject in ["æ•°å­¦", "ç‰©ç†", "åŒ–å­¦"]:
            if complexity == "high":
                return "claude-3-5-sonnet-20241022"  # Claudeé€»è¾‘æ¨ç†å¼º
            else:
                return "gpt-4o-mini"  # æ€§ä»·æ¯”é€‰æ‹©
                
        elif subject in ["è¯­æ–‡", "å†å²", "æ”¿æ²»"]:
            return "yi-large"  # ä¸­æ–‡ç†è§£ä¼˜ç§€
            
        elif subject == "è‹±è¯­":
            return "gpt-4o"  # è‹±è¯­åŸç”Ÿä¼˜åŠ¿
            
        else:
            # é€šç”¨åœºæ™¯
            return "deepseek-chat"  # å¹³è¡¡æ€§ä»·æ¯”
    
    async def assess_quality_score(self, state: dict) -> dict:
        """AIè´¨é‡è¯„ä¼°"""
        
        assessment_prompt = f"""
        è¯·è¯„ä¼°ä»¥ä¸‹ç­”æ¡ˆæ”¹å†™çš„è´¨é‡ï¼ˆ1-10åˆ†ï¼‰ï¼š
        
        åŸå§‹ç­”æ¡ˆï¼š{state['original_answer']}
        æ”¹å†™ç­”æ¡ˆï¼š{state['rewritten_answer']}
        
        è¯„ä¼°ç»´åº¦ï¼š
        1. æ•™å­¦å¯å‘æ€§ï¼ˆæ˜¯å¦å¼•å¯¼æ€è€ƒï¼‰
        2. å†…å®¹å‡†ç¡®æ€§ï¼ˆæ˜¯å¦ä¿æŒæ­£ç¡®ï¼‰
        3. è¯­è¨€é€‚åˆåº¦ï¼ˆæ˜¯å¦ç¬¦åˆå­¦ç”Ÿæ°´å¹³ï¼‰
        4. ç»“æ„æ¸…æ™°åº¦ï¼ˆæ˜¯å¦æ¡ç†åˆ†æ˜ï¼‰
        
        è¿”å›JSONæ ¼å¼ï¼š{{"score": 8, "feedback": "æ”¹å†™å»ºè®®"}}
        """
        
        response = await litellm.acompletion(
            model="gpt-4o-mini",  # ä½¿ç”¨ç»æµæ¨¡å‹è¯„ä¼°
            messages=[{"role": "user", "content": assessment_prompt}],
            temperature=0.3
        )
        
        assessment = json.loads(response.choices[0].message.content)
        
        return {
            **state,
            "quality_score": assessment["score"],
            "feedback": assessment["feedback"]
        }
```

### 3.4 ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ

#### åŠŸèƒ½æè¿°
åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ç³»ç»Ÿï¼Œæ”¯æŒå¤šçº§ç»„ç»‡æ¶æ„å’Œç»†ç²’åº¦æƒé™ç®¡ç†ã€‚

#### ç”¨æˆ·è§’è‰²ä½“ç³»
- **è¶…çº§ç®¡ç†å‘˜**ï¼šå¹³å°å…¨å±€ç®¡ç†æƒé™
- **æœºæ„ç®¡ç†å‘˜**ï¼šç®¡ç†æœºæ„å†…çš„æ•™å¸ˆå’Œå­¦ç”Ÿ
- **æ•™å¸ˆç”¨æˆ·**ï¼šç®¡ç†è‡ªå·±çš„ç­çº§å’Œé¢˜ç›®
- **å­¦ç”Ÿç”¨æˆ·**ï¼šæŸ¥çœ‹ä½œä¸šå’Œä¸AIå¯¹è¯

#### æŠ€æœ¯å®ç°æ–¹æ¡ˆ

```python
# app/services/auth_service.py
from fastapi_users import FastAPIUsers, BaseUserManager
from fastapi_users.authentication import JWTAuthentication
from fastapi_users.db import SQLAlchemyUserDatabase

class AuthService:
    def __init__(self):
        self.user_db = SQLAlchemyUserDatabase(UserDB, database, users)
        self.jwt_auth = JWTAuthentication(
            secret=JWT_SECRET,
            lifetime_seconds=3600,
            tokenUrl="auth/login"
        )
    
    async def register_user(self, user_data: UserCreate, role: str = "student") -> User:
        """ç”¨æˆ·æ³¨å†Œ"""
        
        # éªŒè¯é‚€è¯·ç ï¼ˆTo Båœºæ™¯éœ€è¦é‚€è¯·æ³¨å†Œï¼‰
        if not await self._validate_invitation_code(user_data.invitation_code):
            raise HTTPException(status_code=400, detail="Invalid invitation code")
        
        # åˆ›å»ºç”¨æˆ·
        user = await self.user_manager.create(
            user_data,
            safe=True,
            request=None
        )
        
        # åˆ†é…è§’è‰²æƒé™
        await self.assign_role(user.id, role)
        
        return user
    
    async def assign_permissions(self, user_id: str, permissions: List[str]):
        """åˆ†é…ç”¨æˆ·æƒé™"""
        
        user_permissions = [
            UserPermission(user_id=user_id, permission=perm)
            for perm in permissions
        ]
        
        await self.db.bulk_save_objects(user_permissions)

# æƒé™è£…é¥°å™¨
def require_permission(permission: str):
    def decorator(func):
        async def wrapper(*args, **kwargs):
            current_user = kwargs.get("current_user")
            if not await auth_service.has_permission(current_user.id, permission):
                raise HTTPException(status_code=403, detail="Insufficient permissions")
            return await func(*args, **kwargs)
        return wrapper
    return decorator

# APIä½¿ç”¨ç¤ºä¾‹
@router.post("/questions/upload")
@require_permission("question:create")
async def upload_question(
    file: UploadFile,
    current_user: User = Depends(get_current_user)
):
    return await question_service.process_upload(file, current_user.id)
```

### 3.5 æ™ºèƒ½å­¦ä¹ å¯¹è¯ç³»ç»Ÿ

#### åŠŸèƒ½æè¿°
åŸºäºä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„AIå¯¹è¯ç³»ç»Ÿï¼Œä¸ºå­¦ç”Ÿæä¾›ä¸ªæ€§åŒ–çš„å­¦ä¹ å¼•å¯¼å’Œç­”ç–‘æœåŠ¡ã€‚

#### æ ¸å¿ƒç‰¹æ€§
- **ä¸Šä¸‹æ–‡ç†è§£**ï¼šè®°ä½å½“å‰é¢˜ç›®å’Œå†å²å¯¹è¯
- **å¼•å¯¼å¼æ•™å­¦**ï¼šä¸ç›´æ¥ç»™ç­”æ¡ˆï¼Œè€Œæ˜¯å¯å‘æ€è€ƒ
- **æ–‡æœ¬æ ‡æ³¨æ”¯æŒ**ï¼šé’ˆå¯¹é€‰ä¸­æ–‡æœ¬è¿›è¡Œç²¾å‡†å›ç­”
- **å¤šè½®å¯¹è¯è®°å¿†**ï¼šæ”¯æŒè¿ç»­æ·±å…¥è®¨è®º

#### æŠ€æœ¯å®ç°æ–¹æ¡ˆ

```python
# app/services/intelligent_chat_service.py
from langgraph.graph import StateGraph, END
from langgraph.checkpoint.postgres import PostgresSaver
import litellm

class IntelligentChatService:
    def __init__(self):
        self.ai_framework = UnifiedAIFramework()
        self.cache_service = IntelligentCacheService()
        
        # LangGraphå¯¹è¯å·¥ä½œæµ
        self.chat_workflow = self._build_adaptive_chat_workflow()
        
    async def start_chat_session(self, 
                                student_id: str, 
                                question_id: str) -> str:
        """å¼€å§‹å¯¹è¯ä¼šè¯"""
        
        session_id = f"chat_{student_id}_{question_id}_{int(time.time())}"
        
        # è·å–é¢˜ç›®ä¸Šä¸‹æ–‡
        question_data = await self.db.get_question(question_id)
        
        # åˆå§‹åŒ–å¯¹è¯è®°å¿†
        chat_history = RedisChatMessageHistory(
            session_id=session_id,
            url="redis://localhost:6379/0",
            ttl=86400  # 24å°æ—¶è¿‡æœŸ
        )
        
        memory = ConversationSummaryBufferMemory(
            llm=ChatOpenAI(model="gpt-3.5-turbo"),
            chat_memory=chat_history,
            max_token_limit=1500,
            return_messages=True
        )
        
        # ä¿å­˜ä¼šè¯ä¸Šä¸‹æ–‡
        await self.context_manager.save_session_context(
            session_id=session_id,
            student_id=student_id,
            question_data=question_data,
            memory=memory
        )
        
        return session_id
    
    async def chat_with_ai(self,
                          session_id: str,
                          user_message: str,
                          selected_text: str = None) -> dict:
        """ä¸AIå¯¹è¯"""
        
        # è·å–ä¼šè¯ä¸Šä¸‹æ–‡
        context = await self.context_manager.get_session_context(session_id)
        if not context:
            raise HTTPException(status_code=404, detail="Session not found")
        
        # æ„å»ºå¼•å¯¼å¼ç³»ç»Ÿæç¤º
        system_prompt = await self._build_guidance_prompt(
            context["question_data"], 
            selected_text
        )
        
        # æ„å»ºå¯¹è¯é“¾
        conversation_chain = ConversationChain(
            llm=self.llm_service.get_llm("gpt-4"),
            memory=context["memory"],
            verbose=True
        )
        
        # å¤„ç†ç”¨æˆ·æ¶ˆæ¯
        if selected_text:
            enhanced_message = f"""
æˆ‘å¯¹è¿™éƒ¨åˆ†å†…å®¹æœ‰ç–‘é—®ï¼šã€Œ{selected_text}ã€

æˆ‘çš„é—®é¢˜æ˜¯ï¼š{user_message}
"""
        else:
            enhanced_message = user_message
        
        # ç”ŸæˆAIå›å¤
        ai_response = await conversation_chain.apredict(
            input=enhanced_message,
            system_prompt=system_prompt
        )
        
        # è®°å½•å¯¹è¯è½®æ¬¡
        await self._log_chat_interaction(
            session_id=session_id,
            user_message=enhanced_message,
            ai_response=ai_response,
            selected_text=selected_text
        )
        
        return {
            "response": ai_response,
            "session_id": session_id,
            "can_continue": True
        }
    
    async def _build_guidance_prompt(self, question_data: dict, selected_text: str = None) -> str:
        """æ„å»ºå¼•å¯¼å¼ç³»ç»Ÿæç¤º"""
        
        base_prompt = f"""
ä½ æ˜¯ä¸€ä½è€å¿ƒçš„AIæ•™å­¦åŠ©æ‰‹ï¼Œæ­£åœ¨å¸®åŠ©å­¦ç”Ÿç†è§£ä»¥ä¸‹é¢˜ç›®ï¼š

é¢˜ç›®ï¼š{question_data['question']}
å­¦ç§‘ï¼š{question_data['subject']}
éš¾åº¦ï¼š{question_data['difficulty']}

ä½ çš„æ•™å­¦åŸåˆ™ï¼š
1. ä¸è¦ç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œè€Œè¦å¼•å¯¼å­¦ç”Ÿè‡ªå·±æ€è€ƒ
2. é€šè¿‡æé—®å¸®åŠ©å­¦ç”Ÿå‘ç°é—®é¢˜çš„å…³é”®ç‚¹
3. åˆ†æ­¥éª¤å¼•å¯¼ï¼Œä»ç®€å•åˆ°å¤æ‚
4. é¼“åŠ±å­¦ç”Ÿè¯´å‡ºè‡ªå·±çš„æƒ³æ³•
5. å½“å­¦ç”Ÿè¿·èŒ«æ—¶ï¼Œç»™å‡ºé€‚å½“çš„æç¤º
6. è¯­è¨€è¦äº²åˆ‡è‡ªç„¶ï¼Œç¬¦åˆå­¦ç”Ÿçš„è®¤çŸ¥æ°´å¹³

å½“å­¦ç”Ÿæé—®æ—¶ï¼Œä½ è¦ï¼š
- å…ˆäº†è§£å­¦ç”Ÿçš„å…·ä½“å›°æƒ‘ç‚¹
- é€šè¿‡åé—®ç¡®è®¤å­¦ç”Ÿçš„ç†è§£ç¨‹åº¦
- ç»™å‡ºå¼•å¯¼æ€§çš„æç¤ºï¼Œè€Œéç›´æ¥ç­”æ¡ˆ
- é¼“åŠ±å­¦ç”Ÿå°è¯•è§£å†³é—®é¢˜
"""
        
        if selected_text:
            base_prompt += f"""

å­¦ç”Ÿç‰¹åˆ«å¯¹è¿™éƒ¨åˆ†å†…å®¹æœ‰ç–‘é—®ï¼šã€Œ{selected_text}ã€
è¯·é‡ç‚¹é’ˆå¯¹è¿™éƒ¨åˆ†å†…å®¹è¿›è¡Œå¼•å¯¼è®²è§£ã€‚
"""
        
        return base_prompt

# SSEæµå¼å“åº”æ”¯æŒ
@router.post("/chat/{session_id}/stream")
async def stream_chat(
    session_id: str,
    message: ChatMessage,
    current_user: User = Depends(get_current_student)
):
    async def generate_response():
        response_generator = chat_service.stream_chat_response(
            session_id=session_id,
            user_message=message.content,
            selected_text=message.selected_text
        )
        
        async for chunk in response_generator:
            yield f"data: {json.dumps({'content': chunk})}\n\n"
        
        yield "data: [DONE]\n\n"
    
    return StreamingResponse(
        generate_response(),
        media_type="text/plain"
    )
```

### 3.6 ä½œä¸šå¸ƒç½®ä¸ç®¡ç†ç³»ç»Ÿ

#### åŠŸèƒ½æè¿°
æ•™å¸ˆå¯ä»¥é€‰æ‹©é¢˜ç›®ç»„å»ºä½œä¸šï¼Œå­¦ç”Ÿæ¥æ”¶ä½œä¸šå¹¶è¿›è¡Œå­¦ä¹ äº’åŠ¨ï¼Œç³»ç»Ÿæä¾›æ•°æ®ç»Ÿè®¡å’Œå­¦ä¹ åˆ†æã€‚

#### æ ¸å¿ƒåŠŸèƒ½
- **ä½œä¸šåˆ›å»º**ï¼šæ•™å¸ˆé€‰æ‹©é¢˜ç›®ï¼Œè®¾ç½®æˆªæ­¢æ—¶é—´å’Œå­¦ä¹ è¦æ±‚
- **ä½œä¸šåˆ†å‘**ï¼šè‡ªåŠ¨æ¨é€ç»™æŒ‡å®šç­çº§å­¦ç”Ÿ
- **å­¦ä¹ è·Ÿè¸ª**ï¼šè®°å½•å­¦ç”Ÿçš„å­¦ä¹ è½¨è¿¹å’Œå¯¹è¯è®°å½•
- **æ•°æ®åˆ†æ**ï¼šç”Ÿæˆå­¦ä¹ æŠ¥å‘Šå’Œè–„å¼±ç‚¹åˆ†æ

#### æŠ€æœ¯å®ç°æ–¹æ¡ˆ

```python
# app/services/homework_service.py
class HomeworkService:
    def __init__(self):
        self.question_service = QuestionService()
        self.chat_service = StudentChatService()
        self.analytics_service = LearningAnalyticsService()
    
    async def create_homework(self,
                            teacher_id: str,
                            homework_data: HomeworkCreate) -> Homework:
        """åˆ›å»ºä½œä¸š"""
        
        # éªŒè¯é¢˜ç›®æƒé™
        for question_id in homework_data.question_ids:
            if not await self.question_service.can_access(teacher_id, question_id):
                raise HTTPException(status_code=403, detail=f"Cannot access question {question_id}")
        
        # åˆ›å»ºä½œä¸š
        homework = Homework(
            id=str(uuid.uuid4()),
            title=homework_data.title,
            description=homework_data.description,
            teacher_id=teacher_id,
            class_id=homework_data.class_id,
            question_ids=homework_data.question_ids,
            due_date=homework_data.due_date,
            created_at=datetime.utcnow()
        )
        
        await self.db.save(homework)
        
        # è‡ªåŠ¨åˆ†å‘ç»™ç­çº§å­¦ç”Ÿ
        await self._distribute_homework(homework)
        
        return homework
    
    async def _distribute_homework(self, homework: Homework):
        """åˆ†å‘ä½œä¸šç»™å­¦ç”Ÿ"""
        
        students = await self.db.get_class_students(homework.class_id)
        
        student_homeworks = [
            StudentHomework(
                id=str(uuid.uuid4()),
                homework_id=homework.id,
                student_id=student.id,
                status="assigned",
                assigned_at=datetime.utcnow()
            )
            for student in students
        ]
        
        await self.db.bulk_save(student_homeworks)
        
        # å‘é€é€šçŸ¥
        for student in students:
            await self.notification_service.send_homework_notification(
                student_id=student.id,
                homework=homework
            )
    
    async def get_student_homework_progress(self, 
                                         student_id: str, 
                                         homework_id: str) -> dict:
        """è·å–å­¦ç”Ÿä½œä¸šè¿›åº¦"""
        
        homework = await self.db.get_homework(homework_id)
        student_homework = await self.db.get_student_homework(student_id, homework_id)
        
        question_progress = []
        
        for question_id in homework.question_ids:
            # è·å–å¯¹è¯è®°å½•
            chat_sessions = await self.chat_service.get_question_chat_sessions(
                student_id, question_id
            )
            
            progress = {
                "question_id": question_id,
                "chat_sessions": len(chat_sessions),
                "total_messages": sum(session.message_count for session in chat_sessions),
                "last_interaction": max(session.updated_at for session in chat_sessions) if chat_sessions else None,
                "understanding_level": await self._assess_understanding_level(
                    student_id, question_id, chat_sessions
                )
            }
            
            question_progress.append(progress)
        
        return {
            "homework": homework,
            "student_homework": student_homework,
            "question_progress": question_progress,
            "overall_progress": self._calculate_overall_progress(question_progress)
        }

# å­¦ä¹ åˆ†ææœåŠ¡
class LearningAnalyticsService:
    async def generate_student_report(self, 
                                    student_id: str, 
                                    time_range: tuple = None) -> dict:
        """ç”Ÿæˆå­¦ç”Ÿå­¦ä¹ æŠ¥å‘Š"""
        
        # è·å–å­¦ä¹ æ•°æ®
        chat_data = await self.get_student_chat_data(student_id, time_range)
        homework_data = await self.get_student_homework_data(student_id, time_range)
        
        # åˆ†æå­¦ä¹ æ¨¡å¼
        learning_patterns = await self._analyze_learning_patterns(chat_data)
        
        # è¯†åˆ«è–„å¼±çŸ¥è¯†ç‚¹
        weak_points = await self._identify_weak_knowledge_points(
            student_id, chat_data, homework_data
        )
        
        # ç”Ÿæˆå»ºè®®
        recommendations = await self._generate_learning_recommendations(
            learning_patterns, weak_points
        )
        
        return {
            "student_id": student_id,
            "time_range": time_range,
            "learning_summary": {
                "total_questions": len(set(data["question_id"] for data in chat_data)),
                "total_chat_sessions": len(chat_data),
                "average_session_length": np.mean([data["message_count"] for data in chat_data]),
                "most_active_subject": self._get_most_active_subject(chat_data)
            },
            "learning_patterns": learning_patterns,
            "weak_knowledge_points": weak_points,
            "recommendations": recommendations
        }
```

## å››ã€æ•°æ®åº“è®¾è®¡

### æ•°æ®åº“æ¨¡å‹

```python
# app/models/database_models.py
from sqlalchemy import Column, String, DateTime, JSON, Text, Boolean, Integer, ForeignKey
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship

Base = declarative_base()

class User(Base):
    """ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨"""
    __tablename__ = "users"
    
    id = Column(String, primary_key=True)
    username = Column(String(50), unique=True, nullable=False)
    email = Column(String(255), unique=True, nullable=False)
    password_hash = Column(String(255), nullable=False)
    full_name = Column(String(100))
    role = Column(String(20), nullable=False)  # admin/teacher/student
    organization_id = Column(String, ForeignKey("organizations.id"))
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime)
    updated_at = Column(DateTime)
    
    # å…³ç³»
    organization = relationship("Organization", back_populates="users")
    created_questions = relationship("Question", back_populates="creator")
    student_homeworks = relationship("StudentHomework", back_populates="student")

class Organization(Base):
    """æœºæ„ä¿¡æ¯è¡¨"""
    __tablename__ = "organizations"
    
    id = Column(String, primary_key=True)
    name = Column(String(100), nullable=False)
    code = Column(String(20), unique=True)  # æœºæ„ä»£ç 
    settings = Column(JSON)  # æœºæ„é…ç½®ä¿¡æ¯
    created_at = Column(DateTime)
    
    users = relationship("User", back_populates="organization")
    classes = relationship("Class", back_populates="organization")

class Class(Base):
    """ç­çº§è¡¨"""
    __tablename__ = "classes"
    
    id = Column(String, primary_key=True)
    name = Column(String(100), nullable=False)
    grade_level = Column(String(20))  # å¹´çº§
    subject = Column(String(50))      # å­¦ç§‘
    teacher_id = Column(String, ForeignKey("users.id"))
    organization_id = Column(String, ForeignKey("organizations.id"))
    created_at = Column(DateTime)
    
    teacher = relationship("User", foreign_keys=[teacher_id])
    organization = relationship("Organization", back_populates="classes")
    homeworks = relationship("Homework", back_populates="class_obj")

class Question(Base):
    """é¢˜ç›®è¡¨"""
    __tablename__ = "questions"
    
    id = Column(String, primary_key=True)
    title = Column(String(200))
    content = Column(Text, nullable=False)      # é¢˜ç›®å†…å®¹
    original_answer = Column(Text)              # åŸå§‹ç­”æ¡ˆ
    rewritten_answer = Column(Text)             # AIæ”¹å†™åçš„ç­”æ¡ˆ
    subject = Column(String(50))                # å­¦ç§‘
    question_type = Column(String(50))          # é¢˜ç›®ç±»å‹
    difficulty = Column(String(20))             # éš¾åº¦ç­‰çº§
    knowledge_points = Column(JSON)             # çŸ¥è¯†ç‚¹æ ‡ç­¾
    
    # AIå¤„ç†ç›¸å…³
    extraction_model = Column(String(50))       # æå–ä½¿ç”¨çš„æ¨¡å‹
    rewrite_template_id = Column(String)        # æ”¹å†™ä½¿ç”¨çš„æ¨¡æ¿
    quality_score = Column(Integer)             # è´¨é‡è¯„åˆ† (1-10)
    
    # å…ƒä¿¡æ¯
    creator_id = Column(String, ForeignKey("users.id"))
    source_file_path = Column(String(500))      # åŸå§‹æ–‡ä»¶è·¯å¾„
    has_image = Column(Boolean, default=False)
    has_formula = Column(Boolean, default=False)
    created_at = Column(DateTime)
    updated_at = Column(DateTime)
    
    creator = relationship("User", back_populates="created_questions")

class PromptTemplate(Base):
    """æç¤ºè¯æ¨¡æ¿è¡¨"""
    __tablename__ = "prompt_templates"
    
    id = Column(String, primary_key=True)
    name = Column(String(100), nullable=False)
    category = Column(String(50))               # system/subject/type
    subject = Column(String(50))                # é€‚ç”¨å­¦ç§‘
    question_type = Column(String(50))          # é€‚ç”¨é¢˜å‹
    
    system_prompt = Column(Text)                # ç³»ç»Ÿæç¤ºè¯
    user_prompt_template = Column(Text)         # ç”¨æˆ·æç¤ºè¯æ¨¡æ¿
    variables = Column(JSON)                    # æ¨¡æ¿å˜é‡å®šä¹‰
    examples = Column(JSON)                     # å°‘æ ·æœ¬ç¤ºä¾‹
    
    # ç‰ˆæœ¬æ§åˆ¶
    version = Column(Integer, default=1)
    parent_template_id = Column(String)         # çˆ¶æ¨¡æ¿IDï¼ˆç”¨äºç‰ˆæœ¬æ§åˆ¶ï¼‰
    
    # ä½¿ç”¨ç»Ÿè®¡
    usage_count = Column(Integer, default=0)
    avg_quality_score = Column(Integer)
    
    creator_id = Column(String, ForeignKey("users.id"))
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime)

class Homework(Base):
    """ä½œä¸šè¡¨"""
    __tablename__ = "homeworks"
    
    id = Column(String, primary_key=True)
    title = Column(String(200), nullable=False)
    description = Column(Text)
    
    teacher_id = Column(String, ForeignKey("users.id"))
    class_id = Column(String, ForeignKey("classes.id"))
    question_ids = Column(JSON)                 # åŒ…å«çš„é¢˜ç›®IDåˆ—è¡¨
    
    due_date = Column(DateTime)
    created_at = Column(DateTime)
    updated_at = Column(DateTime)
    
    teacher = relationship("User", foreign_keys=[teacher_id])
    class_obj = relationship("Class", back_populates="homeworks")
    student_homeworks = relationship("StudentHomework", back_populates="homework")

class StudentHomework(Base):
    """å­¦ç”Ÿä½œä¸šè¡¨"""
    __tablename__ = "student_homeworks"
    
    id = Column(String, primary_key=True)
    homework_id = Column(String, ForeignKey("homeworks.id"))
    student_id = Column(String, ForeignKey("users.id"))
    
    status = Column(String(20), default="assigned")  # assigned/in_progress/completed
    progress = Column(JSON)                          # æ¯é“é¢˜çš„è¿›åº¦ä¿¡æ¯
    
    assigned_at = Column(DateTime)
    started_at = Column(DateTime)
    completed_at = Column(DateTime)
    
    homework = relationship("Homework", back_populates="student_homeworks")
    student = relationship("User", back_populates="student_homeworks")

class ChatSession(Base):
    """å¯¹è¯ä¼šè¯è¡¨"""
    __tablename__ = "chat_sessions"
    
    id = Column(String, primary_key=True)
    student_id = Column(String, ForeignKey("users.id"))
    question_id = Column(String, ForeignKey("questions.id"))
    homework_id = Column(String, ForeignKey("homeworks.id"))
    
    session_data = Column(JSON)                 # ä¼šè¯å…ƒæ•°æ®
    message_count = Column(Integer, default=0)
    understanding_level = Column(Integer)       # ç†è§£ç¨‹åº¦è¯„ä¼° (1-5)
    
    started_at = Column(DateTime)
    last_interaction_at = Column(DateTime)

class ChatMessage(Base):
    """å¯¹è¯æ¶ˆæ¯è¡¨"""
    __tablename__ = "chat_messages"
    
    id = Column(String, primary_key=True)
    session_id = Column(String, ForeignKey("chat_sessions.id"))
    
    role = Column(String(10))                   # user/assistant
    content = Column(Text, nullable=False)
    selected_text = Column(Text)                # ç”¨æˆ·é€‰ä¸­çš„æ–‡æœ¬
    
    # AIå“åº”ç›¸å…³
    model_used = Column(String(50))
    token_count = Column(Integer)
    response_time = Column(Integer)             # å“åº”æ—¶é—´(ms)
    from_cache = Column(Boolean, default=False)
    
    created_at = Column(DateTime)

class FileUpload(Base):
    """æ–‡ä»¶ä¸Šä¼ è®°å½•è¡¨"""
    __tablename__ = "file_uploads"
    
    id = Column(String, primary_key=True)
    filename = Column(String(255), nullable=False)
    original_filename = Column(String(255))
    file_path = Column(String(500))
    file_size = Column(Integer)
    file_type = Column(String(50))
    
    # å¤„ç†çŠ¶æ€
    status = Column(String(20), default="uploaded")  # uploaded/processing/completed/failed
    processing_result = Column(JSON)                 # å¤„ç†ç»“æœ
    extracted_questions = Column(JSON)               # æå–çš„é¢˜ç›®åˆ—è¡¨
    
    uploader_id = Column(String, ForeignKey("users.id"))
    created_at = Column(DateTime)
```

### Redisç¼“å­˜ç»“æ„

```python
# Redisæ•°æ®ç»“æ„è®¾è®¡

# 1. æç¤ºè¯ç²¾ç¡®ç¼“å­˜
# Key: exact:{md5_hash}
# Value: {"response": "...", "timestamp": 1640995200, "hit_count": 5}
# TTL: 86400 (24å°æ—¶)

# 2. å¯¹è¯ä¼šè¯ç¼“å­˜  
# Key: chat_session:{session_id}
# Value: {"context": {...}, "memory": {...}}
# TTL: 86400 (24å°æ—¶)

# 3. ç”¨æˆ·æƒé™ç¼“å­˜
# Key: user_permissions:{user_id}
# Value: ["question:create", "homework:assign", ...]
# TTL: 3600 (1å°æ—¶)

# 4. æ–‡ä»¶å¤„ç†é˜Ÿåˆ—
# Key: file_processing_queue
# Type: List
# Value: [{"file_id": "...", "priority": 1}, ...]

# 5. ç»Ÿè®¡æ•°æ®ç¼“å­˜
# Key: stats:{date}:{metric}
# Value: æ•°å€¼
# TTL: 86400 (24å°æ—¶)
```

## äº”ã€APIæ¥å£è®¾è®¡

### 5.1 è®¤è¯æˆæƒæ¥å£

```python
# app/api/auth.py
@router.post("/auth/register")
async def register(user_data: UserRegister):
    """ç”¨æˆ·æ³¨å†Œ"""
    return await auth_service.register_user(user_data)

@router.post("/auth/login")
async def login(credentials: UserLogin):
    """ç”¨æˆ·ç™»å½•"""
    return await auth_service.authenticate(credentials)

@router.post("/auth/refresh")
async def refresh_token(refresh_token: str):
    """åˆ·æ–°è®¿é—®ä»¤ç‰Œ"""
    return await auth_service.refresh_access_token(refresh_token)

@router.get("/auth/profile")
async def get_profile(current_user: User = Depends(get_current_user)):
    """è·å–ç”¨æˆ·ä¿¡æ¯"""
    return current_user
```

### 5.2 é¢˜ç›®ç®¡ç†æ¥å£

```python
# app/api/questions.py
@router.post("/questions/upload")
@require_permission("question:create")
async def upload_file(
    file: UploadFile,
    current_user: User = Depends(get_current_teacher)
):
    """ä¸Šä¼ å¹¶å¤„ç†é¢˜ç›®æ–‡ä»¶"""
    return await question_service.process_file_upload(file, current_user.id)

@router.get("/questions/upload/{file_id}/status")
async def get_upload_status(file_id: str):
    """è·å–æ–‡ä»¶å¤„ç†çŠ¶æ€"""
    return await question_service.get_processing_status(file_id)

@router.get("/questions")
async def list_questions(
    page: int = 1,
    size: int = 20,
    subject: str = None,
    question_type: str = None,
    current_user: User = Depends(get_current_user)
):
    """è·å–é¢˜ç›®åˆ—è¡¨"""
    return await question_service.get_questions(
        page=page, size=size, subject=subject, question_type=question_type,
        user_id=current_user.id
    )

@router.put("/questions/{question_id}/rewrite")
async def rewrite_answer(
    question_id: str,
    rewrite_config: AnswerRewriteConfig,
    current_user: User = Depends(get_current_teacher)
):
    """é‡æ–°æ”¹å†™ç­”æ¡ˆ"""
    return await answer_service.rewrite_answer(
        question_id=question_id,
        config=rewrite_config,
        teacher_id=current_user.id
    )
```

### 5.3 ä½œä¸šç®¡ç†æ¥å£

```python
# app/api/homework.py
@router.post("/homework")
@require_permission("homework:create")
async def create_homework(
    homework_data: HomeworkCreate,
    current_user: User = Depends(get_current_teacher)
):
    """åˆ›å»ºä½œä¸š"""
    return await homework_service.create_homework(current_user.id, homework_data)

@router.get("/homework")
async def list_homeworks(
    role: str = None,  # teacher/student
    current_user: User = Depends(get_current_user)
):
    """è·å–ä½œä¸šåˆ—è¡¨"""
    if current_user.role == "teacher":
        return await homework_service.get_teacher_homeworks(current_user.id)
    else:
        return await homework_service.get_student_homeworks(current_user.id)

@router.get("/homework/{homework_id}/progress")
async def get_homework_progress(
    homework_id: str,
    current_user: User = Depends(get_current_user)
):
    """è·å–ä½œä¸šè¿›åº¦"""
    if current_user.role == "teacher":
        return await homework_service.get_class_progress(homework_id, current_user.id)
    else:
        return await homework_service.get_student_progress(current_user.id, homework_id)
```

### 5.4 å­¦ä¹ å¯¹è¯æ¥å£

```python
# app/api/chat.py
@router.post("/chat/sessions")
async def start_chat_session(
    session_data: ChatSessionStart,
    current_user: User = Depends(get_current_student)
):
    """å¼€å§‹å¯¹è¯ä¼šè¯"""
    return await chat_service.start_chat_session(
        student_id=current_user.id,
        question_id=session_data.question_id
    )

@router.post("/chat/{session_id}/messages")
async def send_message(
    session_id: str,
    message: ChatMessageCreate,
    current_user: User = Depends(get_current_student)
):
    """å‘é€å¯¹è¯æ¶ˆæ¯"""
    return await chat_service.chat_with_ai(
        session_id=session_id,
        user_message=message.content,
        selected_text=message.selected_text
    )

@router.get("/chat/{session_id}/messages")
async def get_chat_history(
    session_id: str,
    current_user: User = Depends(get_current_student)
):
    """è·å–å¯¹è¯å†å²"""
    return await chat_service.get_chat_history(session_id)

@router.post("/chat/{session_id}/stream")
async def stream_chat(
    session_id: str,
    message: ChatMessageCreate,
    current_user: User = Depends(get_current_student)
):
    """æµå¼å¯¹è¯å“åº”"""
    return StreamingResponse(
        chat_service.stream_chat_response(session_id, message),
        media_type="text/plain"
    )
```

## å…­ã€å‰ç«¯é¡µé¢ç»“æ„

### 6.1 é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆåŸºäºVben Admin 5.0ï¼‰

```
TeachAid/
â”œâ”€â”€ app/                         // FastAPIåç«¯ä»£ç 
â”‚   â”œâ”€â”€ core/                   // æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ unified_ai_framework.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”œâ”€â”€ services/               // ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ file_processor.py
â”‚   â”‚   â”œâ”€â”€ prompt_template_service.py
â”‚   â”‚   â”œâ”€â”€ intelligent_cache_service.py
â”‚   â”‚   â”œâ”€â”€ intelligent_rewriting_service.py
â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â”œâ”€â”€ intelligent_chat_service.py
â”‚   â”‚   â””â”€â”€ homework_service.py
â”‚   â”œâ”€â”€ api/                    // APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ questions.py
â”‚   â”‚   â”œâ”€â”€ homework.py
â”‚   â”‚   â””â”€â”€ chat.py
â”‚   â”œâ”€â”€ models/                 // æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ database_models.py
â”‚   â”‚   â””â”€â”€ pydantic_models.py
â”‚   â””â”€â”€ main.py                 // FastAPIåº”ç”¨å…¥å£
â”œâ”€â”€ web/                        // Vben Adminå‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/             // é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ teacher/       // æ•™å¸ˆç«¯é¡µé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ question/  // é¢˜ç›®ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ homework/  // ä½œä¸šç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ class/     // ç­çº§ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ prompt/    // æç¤ºè¯ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ student/       // å­¦ç”Ÿç«¯é¡µé¢
â”‚   â”‚   â”‚       â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚       â”œâ”€â”€ homework/
â”‚   â”‚   â”‚       â”œâ”€â”€ study/     // å­¦ä¹ ç•Œé¢
â”‚   â”‚   â”‚       â””â”€â”€ progress/
â”‚   â”‚   â”œâ”€â”€ components/        // ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ QuestionViewer/
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatPanel/
â”‚   â”‚   â”‚   â”œâ”€â”€ FileUpload/
â”‚   â”‚   â”‚   â””â”€â”€ AIChat/
â”‚   â”‚   â”œâ”€â”€ api/              // APIæ¥å£å°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”‚   â”œâ”€â”€ question.js
â”‚   â”‚   â”‚   â”œâ”€â”€ homework.js
â”‚   â”‚   â”‚   â””â”€â”€ chat.js
â”‚   â”‚   â”œâ”€â”€ stores/           // PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”‚   â”œâ”€â”€ question.js
â”‚   â”‚   â”‚   â””â”€â”€ chat.js
â”‚   â”‚   â”œâ”€â”€ router/           // è·¯ç”±é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ utils/            // å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ assets/           // é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ main.js           // Vueåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ public/               // å…¬å…±èµ„æº
â”‚   â”œâ”€â”€ package.json          // å‰ç«¯ä¾èµ–
â”‚   â”œâ”€â”€ vite.config.js        // Viteé…ç½®
â”‚   â””â”€â”€ .env                  // ç¯å¢ƒå˜é‡
â”œâ”€â”€ uploads/                  // æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ logs/                     // æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ requirements.txt          // Pythonä¾èµ–
â”œâ”€â”€ pnpm-workspace.yaml       // Pnpm Monorepoé…ç½®
â”œâ”€â”€ turbo.json                // TurboRepoé…ç½®
â”œâ”€â”€ docker-compose.yml        // Dockeré…ç½®
â”œâ”€â”€ .eslintrc.js             // ESLinté…ç½®
â”œâ”€â”€ .prettierrc              // Prettieré…ç½®
â””â”€â”€ README.md                // é¡¹ç›®æ–‡æ¡£
```

### 6.2 Vben Adminæ¶æ„ç‰¹è‰²

**ä¼ä¸šçº§å‰ç«¯ç‰¹æ€§ï¼š**
- **æƒé™ç®¡ç†**ï¼šåŸºäºRBACçš„ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±
- **ä¸»é¢˜ç³»ç»Ÿ**ï¼šå¤šå¥—ä¸»é¢˜ï¼Œæ”¯æŒæš—é»‘æ¨¡å¼å’Œè‡ªå®šä¹‰ä¸»é¢˜è‰²
- **å›½é™…åŒ–**ï¼šå®Œæ•´çš„i18næ”¯æŒï¼Œä¸­è‹±æ–‡åˆ‡æ¢
- **å“åº”å¼å¸ƒå±€**ï¼šé€‚é…PCã€å¹³æ¿ã€æ‰‹æœºå¤šç«¯
- **JavaScript**ï¼šè½»é‡çº§å¼€å‘ï¼Œå¿«é€Ÿä¸Šæ‰‹ï¼Œé™ä½å­¦ä¹ æˆæœ¬

**å¼€å‘ä½“éªŒä¼˜åŒ–ï¼š**
- **Monorepo**ï¼šä½¿ç”¨Pnpm + TurboRepoç®¡ç†å¤šåŒ…æ¶æ„
- **ä»£ç è§„èŒƒ**ï¼šESLint + Prettier + Stylelintè‡ªåŠ¨åŒ–ä»£ç è§„èŒƒ
- **ç»„ä»¶å°è£…**ï¼šé«˜åº¦å¯å¤ç”¨çš„ä¸šåŠ¡ç»„ä»¶å’ŒåŸºç¡€ç»„ä»¶
- **çŠ¶æ€ç®¡ç†**ï¼šPiniaç°ä»£åŒ–çŠ¶æ€ç®¡ç†ï¼Œè½»é‡é«˜æ•ˆ
- **æ„å»ºä¼˜åŒ–**ï¼šViteæé€Ÿçƒ­æ›´æ–°ï¼Œæ„å»ºæ€§èƒ½ä¼˜å¼‚

**æ ¸å¿ƒé¡µé¢æ¨¡å—ï¼š**

**æ•™å¸ˆç«¯ï¼š**
- ä»ªè¡¨æ¿ï¼šæ•°æ®æ¦‚è§ˆã€å¿«é€Ÿå…¥å£ã€ç»Ÿè®¡å›¾è¡¨
- é¢˜ç›®ç®¡ç†ï¼šä¸Šä¼ è§£æã€ç­”æ¡ˆæ”¹å†™ã€æ¨¡æ¿é…ç½®
- ä½œä¸šç®¡ç†ï¼šåˆ›å»ºåˆ†å‘ã€è¿›åº¦ç›‘æ§ã€å­¦æƒ…åˆ†æ
- ç­çº§ç®¡ç†ï¼šå­¦ç”Ÿç®¡ç†ã€æƒé™åˆ†é…ã€æ•°æ®ç»Ÿè®¡
- ç³»ç»Ÿè®¾ç½®ï¼šæç¤ºè¯ç®¡ç†ã€AIæ¨¡å‹é…ç½®

**å­¦ç”Ÿç«¯ï¼š**
- å­¦ä¹ ä»ªè¡¨æ¿ï¼šä½œä¸šåˆ—è¡¨ã€å­¦ä¹ è¿›åº¦ã€æˆç»©ç»Ÿè®¡
- æ™ºèƒ½å­¦ä¹ ï¼šé¢˜ç›®å±•ç¤ºã€AIå¯¹è¯ã€ç¬”è®°è®°å½•
- å­¦ä¹ åˆ†æï¼šçŸ¥è¯†ç‚¹æŒæ¡ã€è–„å¼±ç¯èŠ‚ã€å­¦ä¹ å»ºè®®

### 6.3 æ ¸å¿ƒç»„ä»¶è®¾è®¡ï¼ˆJavaScriptç‰ˆæœ¬ï¼‰

```vue
<!-- web/src/components/QuestionViewer/index.vue -->
<template>
  <div class="question-viewer">
    <div class="question-content" v-html="formattedQuestion"></div>
    <div class="answer-section">
      <h3>æ•™å­¦ç­”æ¡ˆ</h3>
      <div 
        class="answer-content"
        @mouseup="handleTextSelection"
        v-html="formattedAnswer">
      </div>
      <el-button 
        v-if="selectedText" 
        @click="askAI"
        type="primary"
        class="ask-ai-btn">
        ğŸ¤– é—®AIè¿™éƒ¨åˆ†
      </el-button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

const props = defineProps(['question', 'rewrittenAnswer'])
const emit = defineEmits(['askAI'])

const selectedText = ref('')

const handleTextSelection = () => {
  const selection = window.getSelection()
  if (selection.rangeCount > 0 && selection.toString().trim()) {
    selectedText.value = selection.toString().trim()
  }
}

const askAI = () => {
  emit('askAI', {
    selectedText: selectedText.value,
    context: props.rewrittenAnswer
  })
  selectedText.value = ''
}
</script>
```

```vue
<!-- web/src/components/ChatPanel/index.vue -->
<template>
  <div class="chat-panel">
    <div class="chat-messages" ref="messagesContainer">
      <div 
        v-for="message in messages" 
        :key="message.id"
        :class="['message', message.role]">
        <div class="message-content" v-html="message.content"></div>
        <div class="message-time">{{ formatTime(message.created_at) }}</div>
      </div>
      <div v-if="isLoading" class="message assistant typing">
        <div class="typing-indicator">AIæ­£åœ¨æ€è€ƒä¸­...</div>
      </div>
    </div>
    
    <div class="chat-input">
      <el-input
        v-model="inputMessage"
        type="textarea"
        :rows="3"
        placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
        @keydown.ctrl.enter="sendMessage">
      </el-input>
      <el-button 
        @click="sendMessage"
        :loading="isLoading"
        type="primary">
        å‘é€
      </el-button>
    </div>
  </div>
</template>

<script setup>
import { ref, nextTick, onMounted } from 'vue'
import { useChat } from '@/composables/useChat'

const props = defineProps(['sessionId'])
const { messages, sendMessage: sendChatMessage, isLoading } = useChat(props.sessionId)

const inputMessage = ref('')
const messagesContainer = ref(null)

const sendMessage = async () => {
  if (!inputMessage.value.trim() || isLoading.value) return
  
  await sendChatMessage(inputMessage.value)
  inputMessage.value = ''
  
  // æ»šåŠ¨åˆ°åº•éƒ¨
  nextTick(() => {
    messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight
  })
}
</script>
```

## ä¸ƒã€éƒ¨ç½²æ–¹æ¡ˆ

### Dockeré…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: 
      context: ./
      dockerfile: Dockerfile
    ports:
      - "8000:8000"    # FastAPIåç«¯
      - "3000:3000"    # Vueå‰ç«¯
    environment:
      - DATABASE_URL=postgresql://teachaid:password@db:5432/teachaid
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=your_jwt_secret_key
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - QWEN_API_KEY=${QWEN_API_KEY}
    depends_on:
      - db
      - redis
    volumes:
      - ./uploads:/app/uploads
      - ./logs:/app/logs
      - ./static:/app/static

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=teachaid
      - POSTGRES_USER=teachaid
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - app

volumes:
  postgres_data:
  redis_data:
```

### å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
# å…‹éš†é¡¹ç›®
git clone <repository_url>
cd TeachAid

# æ–¹å¼ä¸€ï¼šæœ¬åœ°å¼€å‘
# 1. å®‰è£…å…¨å±€ä¾èµ–
npm install -g pnpm

# 2. å®‰è£…Pythonä¾èµ–
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# 3. å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆä½¿ç”¨pnpmï¼‰
cd web
pnpm install

# 4. æ•°æ®åº“åˆå§‹åŒ–
cd ..
alembic upgrade head

# 5. å¯åŠ¨åç«¯æœåŠ¡
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 6. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd web
pnpm dev

# æ–¹å¼äºŒï¼šDockerä¸€é”®å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### é¡¹ç›®é…ç½®æ–‡ä»¶

```json
// web/package.json - å‰ç«¯ä¾èµ–å’Œè„šæœ¬ï¼ˆåŸºäºVben Adminï¼‰
{
  "name": "teachaid-web",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite --host 0.0.0.0 --port 3000",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext .vue,.js --fix",
    "format": "prettier --write ."
  },
  "dependencies": {
    "vue": "^3.5.0",
    "ant-design-vue": "^4.2.0",
    "pinia": "^2.1.0",
    "vue-router": "^4.2.0",
    "axios": "^1.6.0",
    "@vueuse/core": "^10.0.0",
    "lodash-es": "^4.17.21",
    "dayjs": "^1.11.0"
  },
  "devDependencies": {
    "vite": "^5.0.0",
    "@vitejs/plugin-vue": "^4.5.0",
    "eslint": "^8.55.0",
    "eslint-plugin-vue": "^9.18.0",
    "prettier": "^3.1.0",
    "unplugin-auto-import": "^0.17.0",
    "unplugin-vue-components": "^0.26.0"
  }
}

// pnpm-workspace.yaml - Monorepoé…ç½®
packages:
  - 'web'
  - 'app'

// web/vite.config.js - Viteé…ç½®
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { AntDesignVueResolver } from 'unplugin-vue-components/resolvers'

export default defineConfig({
  plugins: [
    vue(),
    AutoImport({
      imports: ['vue', 'vue-router', 'pinia'],
      dts: true
    }),
    Components({
      resolvers: [AntDesignVueResolver()],
      dts: true
    })
  ],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    host: '0.0.0.0',
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    chunkSizeWarningLimit: 2000
  }
})
```

```dockerfile
# Dockerfile - ä¸€ä½“åŒ–éƒ¨ç½²
FROM python:3.11-slim

# å®‰è£…Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs

WORKDIR /app

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# å®‰è£…Pythonä¾èµ–
RUN pip install -r requirements.txt

# å®‰è£…pnpmå¹¶æ„å»ºå‰ç«¯
RUN npm install -g pnpm
COPY web/ ./web/
RUN cd web && pnpm install && pnpm build

# æš´éœ²ç«¯å£
EXPOSE 8000 3000

# å¯åŠ¨è„šæœ¬
CMD ["sh", "-c", "uvicorn app.main:app --host 0.0.0.0 --port 8000 & cd web && pnpm preview -- --host 0.0.0.0 --port 3000"]
```

## å…«ã€æ€»ç»“

æœ¬è®¾è®¡æ–¹æ¡ˆé‡‡ç”¨äº†ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼Œç»“åˆAIèƒ½åŠ›ï¼Œä¸ºæ•™åŸ¹æœºæ„æä¾›äº†å®Œæ•´çš„æ™ºèƒ½æ•™å­¦è§£å†³æ–¹æ¡ˆã€‚æ ¸å¿ƒç‰¹è‰²åŒ…æ‹¬ï¼š

1. **å¤šæ¨¡æ€AIç†è§£**ï¼šæ›¿ä»£ä¼ ç»ŸOCRï¼Œæ›´å‡†ç¡®ç†è§£å¤æ‚æ•™å­¦å†…å®¹
2. **æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ**ï¼šæ˜¾è‘—é™ä½AIè°ƒç”¨æˆæœ¬ï¼Œæå‡å“åº”é€Ÿåº¦  
3. **å¼•å¯¼å¼æ•™å­¦**ï¼šAIä¸ç›´æ¥ç»™ç­”æ¡ˆï¼Œè€Œæ˜¯å¯å‘å­¦ç”Ÿæ€è€ƒ
4. **æ¸è¿›å¼æ¶æ„**ï¼šä»ç®€å•å¼€å§‹ï¼Œæ”¯æŒæœªæ¥å¤æ‚åŠŸèƒ½æ‰©å±•
5. **å®Œæ•´æƒé™æ§åˆ¶**ï¼šæ”¯æŒå¤šè§’è‰²ã€å¤šçº§ç»„ç»‡çš„æƒé™ç®¡ç†

è¯¥æ–¹æ¡ˆå…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ï¼Œèƒ½å¤Ÿæ»¡è¶³æ•™åŸ¹æœºæ„çš„å®é™…ä¸šåŠ¡éœ€æ±‚ã€‚

<function_calls>
<invoke name="TodoWrite">
<parameter name="todos">[{"content": "\u4f18\u5316README.md\u529f\u80fd\u8bbe\u8ba1", "status": "completed", "activeForm": "\u4f18\u5316README.md\u529f\u80fd\u8bbe\u8ba1"}, {"content": "\u8be6\u7ec6\u8bbe\u8ba1\u6bcf\u4e2a\u6838\u5fc3\u529f\u80fd\u7684\u5b9e\u73b0\u65b9\u6848", "status": "in_progress", "activeForm": "\u8be6\u7ec6\u8bbe\u8ba1\u6bcf\u4e2a\u6838\u5fc3\u529f\u80fd\u7684\u5b9e\u73b0\u65b9\u6848"}, {"content": "\u8bbe\u8ba1\u6280\u672f\u67b6\u6784\u548c\u6570\u636e\u5e93\u6a21\u578b", "status": "pending", "activeForm": "\u8bbe\u8ba1\u6280\u672f\u67b6\u6784\u548c\u6570\u636e\u5e93\u6a21\u578b"}, {"content": "\u8bbe\u8ba1API\u63a5\u53e3\u89c4\u8303", "status": "pending", "activeForm": "\u8bbe\u8ba1API\u63a5\u53e3\u89c4\u8303"}, {"content": "\u8bbe\u8ba1\u524d\u7aef\u9875\u9762\u7ed3\u6784", "status": "pending", "activeForm": "\u8bbe\u8ba1\u524d\u7aef\u9875\u9762\u7ed3\u6784"}]